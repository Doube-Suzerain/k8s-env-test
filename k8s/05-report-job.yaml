---
# Job 5: 报告汇总
apiVersion: batch/v1
kind: Job
metadata:
  name: env-test-report
  namespace: default
spec:
  template:
    metadata:
      labels:
        app: env-test-report
    spec:
      volumes:
      - name: scripts
        hostPath:
          path: /data/zyn/k8s-env-test/scripts
      - name: results
        hostPath:
          path: /tmp/env-test-results
      containers:
      - name: reporter
        image: docker.1ms.run/lmsysorg/sglang:v0.5.6.post2
        imagePullPolicy: IfNotPresent
        command: ["/usr/bin/python3", "/scripts/collect_results.py"]
        env:
        - name: RESULTS_DIR
          value: /results
        - name: OUTPUT_FILE
          value: /results/test_report.json
        volumeMounts:
        - name: scripts
          mountPath: /scripts
          readOnly: true
        - name: results
          mountPath: /results
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
      restartPolicy: OnFailure
